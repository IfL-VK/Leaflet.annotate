<!DOCTYPE html>
<html>

	<head>

		<title>Paris Map - Public Sculptures in Wikidata</title>

		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="author" content="Malte Reißig, IfL Leipzig">

		<!--link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" /-->
		<link rel="stylesheet" href="vendor/Leaflet-0.7.7/dist/leaflet.css" />
		<link rel="stylesheet" href="css/example.css" />
		<!-- link rel="stylesheet" href="css/foundation.min.css" /-->
		<link rel="stylesheet" href="css/viewer-style.css" />

		<!--script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script-->
		<!--script src="https://code.jquery.com/jquery-2.2.3.min.js"
				integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo=" crossorigin="anonymous"></script-->
		<script src="vendor/Leaflet-0.7.7/dist/leaflet-src.js"></script>
		<script src="vendor/jquery-2.2.2.min.js"></script>

		<!-- Microdata.js needs to be loaded before Leaflet.annotate.Viewer.js due to a CONSTANT-->
		<script src="Leaflet.annotate.Microdata.js"></script>
		<script src="Leaflet.annotate.Viewer.js"></script>
		<script src="wikidata_queries.js"></script>

	</head>

	<body>

		<div id="map"></div>

		<div class="author">Meta Mata</div>

		<script type="text/javascript">

			var tileLayerURL = 'https://api.tiles.mapbox.com/v4/maltwisney.91ae9b43/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFsdHdpc25leSIsImEiOiJlODg3M2M5YzFhY2Y2NWMzMmE0Nzk1YWNjMWYwN2U0ZCJ9.b_4gukx7cUR4-spxHbj_Kw'

			var map, tileLayer, featureGroup;

			function setup_map() {

				map = L.map('map')

				tileLayer = L.tileLayer(tileLayerURL, {
					attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
					'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
					'Imagery © <a href="http://mapbox.com">Mapbox</a>',
					id: 'mapbox.light'
				})
				tileLayer.addTo(map)

				map.setView(L.latLng([48.8518, 2.3391]), 13)

				// --- Defused Work in Progress  ---
				// L.readerPlugin(map)
				map.addControl(L.control.annotationViewer())

				// --- Layout Helpers ---
				$('#map').css('height', window.innerHeight + 'px')
				$(window).resize(function(e) { $('#map').css('height', window.innerHeight + 'px') })

				featureGroup = L.featureGroup().addTo(map)

				// --- Map Data Setup
				wd.load_public_sculptures_in_paris(function(sculpturesInParis) {
					console.log("Wikidata SPARQL Query Successfull", sculpturesInParis)
					for (var scidx in sculpturesInParis.results.bindings) {
						var wikidataSculptureData = sculpturesInParis.results.bindings[scidx]
						if (wikidataSculptureData.coord && wikidataSculptureData.image) {
							var geosparqlPoint = wikidataSculptureData.coord.value.substr(6)
							var coordinates = L.latLng(geosparqlPoint.split(" ")[1], geosparqlPoint.split(" ")[0])
							var imagePath = wikidataSculptureData.image
							var imageUrl = imagePath.value
							/** var sculpture = L.circleMarker(coordinates, { // ### improve new colors for angebote rendering
						            weight: 2, opacity: 0.6, fillColor: "#a9a9a9", fillOpacity: 0.2, lineCap: 'square',
						            color : "#8f1414", title: wikidataSculptureData.title.value, itemtype: 'CreativeWork',
						            alt: "Place of a sculpture named " + wikidataSculptureData.title.value })
								.bindPopup('<h3>' + wikidataSculptureData.title.value + '</h3>' + '<p><img src="'+imageUrl+'"></p>',
									{ keepInView: true, className: 'sculpture-photo', maxWidth: "auto", minWidth: 320}) */
							var sculpture = L.marker(coordinates,
									{ title: wikidataSculptureData.title.value, itemtype: 'CreativeWork'})
								.bindPopup('<h3>' + wikidataSculptureData.title.value + '</h3>' + '<p><img src="'+imageUrl+'"></p>',
									{ keepInView: true, className: 'sculpture-photo', maxWidth: "auto"})
							/** imageBounds = [[40.712216, -74.22655], [40.773941, -74.12544]]; */
							// L.imageOverlay(imageUrl, imageBounds, {"itemtype": "CreativeWork", "geoprop": "contentLocation"}).addTo(map); */
							sculpture.addTo(featureGroup)
						}
					}
				}, function(error) {
					console.warn("Wikidata SPARQL Query FAILED", error)
				})


			}

			function adjust_map_view() {
				var evt = document.createEvent('UIEvents')
				evt.initUIEvent('resize', true, false, window,0)
				window.dispatchEvent(evt)
			}

			setup_map()
			adjust_map_view()

		</script>

	</body>
</html>
