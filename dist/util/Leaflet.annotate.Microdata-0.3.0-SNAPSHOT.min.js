/**
    This is leaflet.annotate-0.3.0-SNAPSHOT
    Author: Malte ReiÃŸig 
    Project Page: https://mukil.github.io/Leaflet.annotate 
    API Documentation:, https://github.com/mukil/Leaflet.annotate#readme **/

var SCHEMA_ORG="http://schema.org/",Microdata={annotate:function(){var a=this._getTargetDOMElement();return a?this._buildAnnotations(a):(this.on("add",function(){a=this._getTargetDOMElement(),this._buildAnnotations(a)}),this.on("open",function(){a=this._getTargetDOMElement(),this._buildAnnotations(a)}),this.on("load",function(b){a=this._getTargetDOMElement(),this._buildAnnotations(a)}),this.on("close",function(){var a=[];this._findPopupContainerElement(this,a),this._container=a[0]})),this},_findPopupContainerElement:function(a,b){var c=a._container.childNodes;for(var d in c){var a=c[d];if(a.className.indexOf("leaflet-popup")!=-1)return a}},_findContainerElements:function(a,b){if(a._container&&b.push(a._container),a._layers)for(var c in a._layers){var d=a._layers[c];this._findContainerElements(d,b)}},_findSVGGroupElements:function(a,b){if(a._container&&"g"===a._container.localName&&b.push(a),a._layers)for(var c in a._layers){var d=a._layers[c];this._findSVGGroupElements(d,b)}},_buildPolygonArray:function(a){var b=[];for(var c in a)b.push(a[c].lat),b.push(a[c].lng);return b},_createMetaElement:function(a,b){var c=document.createElement("meta");return c.setAttribute(a,b),c},_createGroupingElement:function(a,b,c){var d=document.createElement(a);return d.setAttribute(b,c),d},_buildAnnotations:function(a){"[object Array]"!==Object.prototype.toString.call(a)&&(a=[a]);var b=void 0,c=a[0],d=c.parentNode,e=this.options.hasOwnProperty("geoprop")?this.options.geoprop:"geo",f=this.options.hasOwnProperty("domId")?this.options.domId:void 0,g="g"===c.tagName,h=this.hasOwnProperty("_latlng"),i=this.hasOwnProperty("_bounds"),j=this.hasOwnProperty("_layers"),k=this._leaflet_id;if(!g&&this.options.hasOwnProperty("itemtype")){b=this._buildAnnotationsContainer("article",f,k),this._buildGenericProperties(b,this);var l=void 0;if(h&&!i)l=this._buildGeoAnnotation("div",this,"point",e);else{if(!i)return console.log("Invalid argument provided: Neither a BoundingBox nor a Coordinate Pair could be detected to build a geographic annotation."),void console.warn("Skipping semantic annotation of the following Leaflet item due to a previous error",this);l=this._buildGeoAnnotation("div",this,"box",e)}b.appendChild(l),b.appendChild(c),d.className.indexOf("overlay-pane")==-1&&d.className.indexOf("marker-pane")==-1&&(d.innerHTML=""),d.appendChild(b),this.options._annotated=!0}else if(g&&this.options.hasOwnProperty("itemtype")){if(j){var m=[];this._findSVGGroupElements(this,m);for(var n in m){var o=m[n],p=o._container;b=this._buildAnnotationsContainer("metadata",f,o._leaflet_id),this._buildGenericProperties(b,this);var q=this._buildGeoAnnotation("g",o,"shape",e);b.appendChild(q),p.appendChild(b)}b=void 0}else{b=this._buildAnnotationsContainer("metadata",f,k),this._buildGenericProperties(b,this);var q=this._buildGeoAnnotation("g",this,"point",e);b.appendChild(q)}b&&(c.appendChild(b),this.options._annotated=!0)}},_buildAnnotationsContainer:function(a,b,c){var d=document.createElement(a);return b&&d.setAttribute("id",b),d.setAttribute("itemscope",""),d.setAttribute("itemtype","http://schema.org/"+this.options.itemtype),d.setAttribute("data-internal-leaflet-id",c),d},_buildGenericProperties:function(a,b){b.options.hasOwnProperty("title")&&this._appendMetaItempropContent(a,"name",b.options.title),b.options.hasOwnProperty("description")&&this._appendMetaItempropContent(a,"description",b.options.description),b.options.hasOwnProperty("url")&&this._appendMetaItempropContent(a,"url",b.options.url),b.options.hasOwnProperty("sameAs")&&this._appendMetaItempropContent(a,"sameAs",b.options.sameAs),b.options.hasOwnProperty("alternateName")&&this._appendMetaItempropContent(a,"alternateName",b.options.alternateName),b.options.hasOwnProperty("image")&&this._appendMetaItempropContent(a,"image",b.options.image),b.options.hasOwnProperty("creator")&&this._appendMetaNameContent(a,"http://purl.org/dc/elements/1.1/creator",b.options.creator),b.options.hasOwnProperty("contributor")&&this._appendMetaNameContent(a,"http://purl.org/dc/elements/1.1/contributor",b.options.contributor),b.options.hasOwnProperty("publisher")&&this._appendMetaNameContent(a,"http://purl.org/dc/elements/1.1/publisher",b.options.publisher),b.options.hasOwnProperty("published")&&this._appendMetaNameContent(a,"http://purl.org/dc/elements/1.1/date",b.options.published),b.options.hasOwnProperty("identifier")&&this._appendMetaNameContent(a,"http://purl.org/dc/elements/1.1/identifier",b.options.identifier),b.options.hasOwnProperty("rights")&&this._appendMetaNameContent(a,"http://purl.org/dc/elements/1.1/rights",b.options.rights),b.options.hasOwnProperty("derivedFrom")&&this._appendMetaNameContent(a,"http://purl.org/dc/elements/1.1/source",b.options.derivedFrom),b.options.hasOwnProperty("format")&&this._appendMetaNameContent(a,"http://purl.org/dc/elements/1.1/format",b.options.format),b.options.hasOwnProperty("language")&&this._appendMetaNameContent(a,"http://purl.org/dc/elements/1.1/language",b.options.language),b.options.hasOwnProperty("created")&&this._appendMetaNameContent(a,"http://purl.org/dc/terms/created",b.options.created),b.options.hasOwnProperty("modified")&&this._appendMetaNameContent(a,"http://purl.org/dc/terms/modified",b.options.modified)},_appendMetaNameContent:function(a,b,c){var d=this._createMetaElement("name",b);d.setAttribute("content",c),a.appendChild(d)},_appendMetaItempropContent:function(a,b,c){var d=this._createMetaElement("itemprop",b);d.setAttribute("content",c),a.appendChild(d)},_buildGeoAnnotation:function(a,b,c,d){if("object"!=typeof a&&(a=document.createElement(a)),hasGeoProperty(b.options.itemtype))a.setAttribute("itemprop",d),this._buildGeographicIndicators(a,c,b);else if(isValidPlaceProperty(d)){a.setAttribute("itemscope",""),a.setAttribute("itemtype","http://schema.org/Place"),a.setAttribute("itemprop",d);var e=this._createGroupingElement(a.localName,"itemprop","geo");this._buildGeographicIndicators(e,c,b),a.appendChild(e)}else console.warn("Could not build up geo annotations for "+b.options.itemtype+' and an undefined "geoproperty" value ');return a},_buildGeographicIndicators:function(a,b,c){if("shape"===b){a.setAttribute("itemtype","http://schema.org/GeoShape"),a.setAttribute("itemscope","");var d=this._createMetaElement("itemprop","polygon");d.setAttribute("content",this._buildPolygonArray(c._latlngs)),a.appendChild(d)}else if("point"===b){a.setAttribute("itemtype","http://schema.org/GeoCoordinates"),a.setAttribute("itemscope","");var e=this._createMetaElement("itemprop","latitude");e.setAttribute("content",c._latlng.lat);var f=this._createMetaElement("itemprop","longitude");f.setAttribute("content",c._latlng.lng),a.appendChild(e),a.appendChild(f)}else if("box"===b){a.setAttribute("itemtype","http://schema.org/GeoShape"),a.setAttribute("itemscope","");var d=this._createMetaElement("itemprop","box");d.setAttribute("content",c._bounds._southWest.lat+","+c._bounds._southWest.lng+" "+c._bounds._northEast.lat+","+c._bounds._northEast.lng),a.appendChild(d)}else console.warn("Unsupported type of geographic value indication, currently supported are 'point', 'box' and 'polygon'")}},superMarkerOnRemove=L.Marker.prototype.onRemove;L.Marker.include(Microdata),L.Marker.addInitHook(function(){this.annotate()}),L.Marker.include({_getTargetDOMElement:function(){return this._icon},onRemove:function(a){this.options._annotated&&(this._icon=this._icon.parentNode),superMarkerOnRemove.call(this,a)}}),L.CircleMarker.include(Microdata),L.CircleMarker.addInitHook(function(){this.annotate()}),L.CircleMarker.include({_getTargetDOMElement:function(){var a=[];return this._findContainerElements(this,a),a.length>0?a[0]:null}}),L.Popup.include(Microdata),L.Popup.addInitHook(function(){this.annotate()});var superPopupOnRemove=L.Popup.prototype.onRemove;L.Popup.include({_getTargetDOMElement:function(){if(this.hasOwnProperty("_container"))return this._container},onRemove:function(a){this.options._annotated&&(this._container=this._container.parentNode),superPopupOnRemove.call(this,a)}}),L.LayerGroup.include(Microdata),L.LayerGroup.addInitHook(function(){this.annotate()}),L.LayerGroup.include({_getTargetDOMElement:function(){var a=[];return this._findContainerElements(this,a),a.length>0?a[0]:null}}),L.ImageOverlay.include(Microdata),L.ImageOverlay.addInitHook(function(){this.annotate()}),L.ImageOverlay.include({_getTargetDOMElement:function(){if(this.hasOwnProperty("_image"))return this._image}});